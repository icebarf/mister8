#include <stdio.h>

#include "chip8.h"
#include "util.h"

// clang-format off
#define font \
{ \
0xF0, 0x90, 0x90, 0x90, 0xF0,\
0x20, 0x60, 0x20, 0x20, 0x70,\
0xF0, 0x10, 0xF0, 0x80, 0xF0,\
0xF0, 0x10, 0xF0, 0x10, 0xF0,\
0x90, 0x90, 0xF0, 0x10, 0x10,\
0xF0, 0x80, 0xF0, 0x10, 0xF0,\
0xF0, 0x80, 0xF0, 0x90, 0xF0,\
0xF0, 0x10, 0x20, 0x40, 0x40,\
0xF0, 0x90, 0xF0, 0x90, 0xF0,\
0xF0, 0x90, 0xF0, 0x10, 0xF0,\
0xF0, 0x90, 0xF0, 0x90, 0x90,\
0xE0, 0x90, 0xE0, 0x90, 0xE0,\
0xF0, 0x80, 0x80, 0x80, 0xF0,\
0xE0, 0x90, 0x90, 0x90, 0xE0,\
0xF0, 0x80, 0xF0, 0x80, 0xF0,\
0xF0, 0x80, 0xF0, 0x80, 0x80 \
}
// clang-format on

static inline uint16_t
fetch(memory_t* memory, uint16_t* pc)
{
  uint16_t inst = (uint16_t)((*memory)[*pc] << 8 | (*memory)[(*pc) + 1]);
  pc += 2;
  return inst;
}

int
main(int argc, char** argv)
{
  if (argc != 2) {
    fprintf(stdout, "./mister8 romfile\n");
    return 0;
  }

  struct system chip8 = { .memory = font, { 0 } };

  int read_bytes = read_file(argv[1], &chip8.memory);
  if (read_bytes <= 0)
    return 1;
  fprintf(stdout, "File: %s\nBytes Read: %i\n", argv[1], read_bytes);
}
